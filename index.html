<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V2 - TEST CONNEXION ASCENSEURS</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: Arial; margin: 20px; background: #f0f8ff; }
        .test-section { border: 2px solid #007cba; padding: 15px; margin: 10px 0; border-radius: 8px; background: white; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        .warning { color: orange; font-weight: bold; }
        button { padding: 10px; margin: 5px; background: #007cba; color: white; border: none; border-radius: 4px; cursor: pointer; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 4px; overflow-x: auto; }
        .info { background: #e7f3ff; padding: 10px; border-radius: 4px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>üîß V2 - TEST COMPLET ASCENSORISTE PACA</h1>
    
    <div class="info">
        <strong>üîç Diagnostic en cours...</strong>
        <p>Probl√®me d√©tect√© : <span class="error">Erreur de r√©solution DNS</span></p>
    </div>

    <div class="test-section">
        <h2>1. Test DNS et R√©seau</h2>
        <button onclick="testReseau()">üåê Tester Acc√®s Internet</button>
        <div id="testReseau"></div>
    </div>

    <div class="test-section">
        <h2>2. Test Connexion Supabase</h2>
        <button onclick="testSupabase()">üîó Tester Supabase</button>
        <div id="testSupabase"></div>
    </div>

    <div class="test-section">
        <h2>3. Solution Alternative</h2>
        <button onclick="solutionSecours()">üîÑ Mode Secours</button>
        <div id="solutionSecours"></div>
    </div>

    <script>
        // CONFIGURATION V2
        const SUPABASE_CONFIG = {
            url: 'https://prrzsosrbrskmeczmmmu.supabase.co',
            key: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBycnpzb3NicnJza21lY3ptbW11Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjEzMTkwMDMsImV4cCI6MjA3Njg5NTAwM30.JuqL6tJC5LRXX30HXrznm_y9bca-aOJ_vnk_wPsP9Mc'
        };

        let supabaseClient = null;

        // TEST 1: V√©rification r√©seau
        async function testReseau() {
            const div = document.getElementById('testReseau');
            div.innerHTML = "üåê Test de connexion internet...";
            
            try {
                // Test de base de connexion internet
                const response = await fetch('https://httpbin.org/get', { 
                    method: 'GET',
                    mode: 'no-cors'
                });
                
                div.innerHTML = `
                    <span class="success">‚úÖ Connexion internet OK</span>
                    <br><br>
                    <strong>Prochain test :</strong> V√©rification Supabase...
                    <script>
                        setTimeout(testSupabase, 2000);
                    </script>
                `;
                
            } catch (error) {
                div.innerHTML = `
                    <span class="error">‚ùå Probl√®me de connexion internet</span>
                    <br><br>
                    <strong>Solutions :</strong>
                    <ul>
                        <li>V√©rifiez votre connexion WiFi/4G</li>
                        <li>Essayez un autre r√©seau</li>
                        <li>Red√©marrez votre routeur</li>
                    </ul>
                `;
            }
        }

        // TEST 2: Test Supabase avec gestion d'erreur am√©lior√©e
        async function testSupabase() {
            const div = document.getElementById('testSupabase');
            div.innerHTML = "üîó Initialisation Supabase...";
            
            try {
                // Test de r√©solution DNS d'abord
                div.innerHTML += "<br>üîç R√©solution DNS...";
                
                // Cr√©ation du client Supabase
                supabaseClient = supabase.createClient(SUPABASE_CONFIG.url, SUPABASE_CONFIG.key);
                
                // Test simple
                div.innerHTML += "<br>üì° Test de connexion...";
                const { data, error } = await supabaseClient
                    .from('documents')
                    .select('*')
                    .limit(1)
                    .timeout(10000); // 10 secondes timeout
                
                if (error) {
                    if (error.message.includes('Failed to fetch') || error.message.includes('resolve')) {
                        div.innerHTML = `
                            <span class="error">‚ùå ERREUR DNS - Impossible de joindre Supabase</span>
                            <br><br>
                            <strong>Probl√®me :</strong> L'URL Supabase n'est pas accessible
                            <br><br>
                            <strong>Solutions :</strong>
                            <ul>
                                <li>V√©rifiez que 'prrzsosrbrskmeczmmmu.supabase.co' est correct</li>
                                <li>Testez l'URL dans votre navigateur</li>
                                <li>Contactez le support Supabase</li>
                            </ul>
                        `;
                    } else {
                        div.innerHTML = `<span class="warning">‚ö†Ô∏è Connexion √©tablie mais erreur: ${error.message}</span>`;
                    }
                } else {
                    div.innerHTML = `
                        <span class="success">‚úÖ CONNEXION SUPABASE R√âUSSIE!</span>
                        <br><br>
                        <strong>${data.length} document(s) accessible(s)</strong>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                }
                
            } catch (error) {
                div.innerHTML = `
                    <span class="error">‚ùå ERREUR CRITIQUE: ${error.message}</span>
                    <br><br>
                    <strong>Diagnostic :</strong>
                    <ul>
                        <li>URL Supabase: ${SUPABASE_CONFIG.url}</li>
                        <li>Statut: Non accessible</li>
                        <li>Type: Erreur r√©seau/DNS</li>
                    </ul>
                `;
            }
        }

        // SOLUTION ALTERNATIVE
        function solutionSecours() {
            const div = document.getElementById('solutionSecours');
            div.innerHTML = `
                <div class="info">
                    <h3>üîÑ Mode Secours Activ√©</h3>
                    <p><strong>Probl√®me confirm√© :</strong> L'URL Supabase n'est pas r√©solue</p>
                    
                    <strong>√âtapes de d√©pannage :</strong>
                    <ol>
                        <li>Ouvrez un nouvel onglet</li>
                        <li>Allez √† : <a href="https://prrzsosrbrskmeczmmmu.supabase.co" target="_blank">https://prrzsosrbrskmeczmmmu.supabase.co</a></li>
                        <li>Si la page ne s'ouvre pas, le probl√®me vient de Supabase</li>
                        <li>Contactez le support Supabase</li>
                    </ol>
                    
                    <strong>Solution temporaire :</strong>
                    <p>Utilisez cette URL alternative pour tester :</p>
                    <button onclick="testerURLOption()">üåê Tester URL Alternative</button>
                    <div id="testURL"></div>
                </div>
            `;
        }

        // Test d'URL alternative
        async function testerURLOption() {
            const div = document.getElementById('testURL');
            div.innerHTML = "Test d'URL alternative...";
            
            // Test avec une autre m√©thode
            try {
                const response = await fetch('https://prrzsosrbrskmeczmmmu.supabase.co/rest/v1/', {
                    method: 'GET',
                    headers: {
                        'apikey': SUPABASE_CONFIG.key,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    div.innerHTML = `<span class="success">‚úÖ URL accessible via fetch direct</span>`;
                } else {
                    div.innerHTML = `<span class="error">‚ùå URL inaccessible (Status: ${response.status})</span>`;
                }
            } catch (error) {
                div.innerHTML = `<span class="error">‚ùå Erreur fetch: ${error.message}</span>`;
            }
        }

        // Test automatique au chargement
        document.addEventListener('DOMContentLoaded', function() {
            console.log("üöÄ V2 - Diagnostic ASCENSORISTE PACA charg√©");
            setTimeout(testReseau, 1000);
        });

    </script>
</body>
</html>
