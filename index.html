<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Admin - Documents Ascenseur</title>
</head>
<body>
  <h1>ðŸ“‚ Fichiers techniques ascenseur</h1>

  <label for="marque">Marque :</label>
  <select id="marque"></select>

  <label for="modele">ModÃ¨le :</label>
  <select id="modele"></select>

  <label for="type_doc">Type de document :</label>
  <select id="type_doc">
    <option value="technique">Technique</option>
    <option value="schema">SchÃ©ma</option>
  </select>

  <div id="resultat"></div>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

    const supabaseUrl = 'https://TON_URL_SUPABASE.supabase.co'
    const supabaseKey = 'TON_ANON_KEY'
    const supabase = createClient(supabaseUrl, supabaseKey)

    const marqueSelect = document.getElementById('marque')
    const modeleSelect = document.getElementById('modele')
    const typeDocSelect = document.getElementById('type_doc')
    const resultatDiv = document.getElementById('resultat')

    async function chargerMarques() {
      const { data, error } = await supabase
        .from('documents')
        .select('marque')
      if (error) {
        console.error('Erreur chargement marques', error)
        return
      }
      const marques = [...new Set(data.map(item => item.marque).filter(Boolean))]
      marqueSelect.innerHTML = marques.map(m => `<option value="${m}">${m}</option>`).join('')
      chargerModeles()
    }

    async function chargerModeles() {
      const marqueChoisie = marqueSelect.value
      const { data, error } = await supabase
        .from('documents')
        .select('modele')
        .eq('marque', marqueChoisie)
      if (error) {
        console.error('Erreur chargement modÃ¨les', error)
        return
      }
      const modeles = [...new Set(data.map(item => item.modele).filter(Boolean))]
      modeleSelect.innerHTML = modeles.map(m => `<option value="${m}">${m}</option>`).join('')
      afficherFichiers()
    }

    async function afficherFichiers() {
      const marque = marqueSelect.value
      const modele = modeleSelect.value
      const type_doc = typeDocSelect.value

      const { data, error } = await supabase
        .from('documents')
        .select('filename, path')
        .eq('marque', marque)
        .eq('modele', modele)
        .eq('type_doc', type_doc)

      if (error) {
        console.error('Erreur chargement fichiers', error)
        return
      }

      if (data.length === 0) {
        resultatDiv.innerHTML = '<p>Aucun fichier trouvÃ©.</p>'
        return
      }

      resultatDiv.innerHTML = data.map(doc => `
        <p><a href="https://TON_URL_SUPABASE.supabase.co/storage/v1/object/public/${doc.path}" target="_blank">${doc.filename}</a></p>
      `).join('')
    }

    marqueSelect.addEventListener('change', chargerModeles)
    modeleSelect.addEventListener('change', afficherFichiers)
    typeDocSelect.addEventListener('change', afficherFichiers)

    chargerMarques()
  </script>
</body>
</html>
