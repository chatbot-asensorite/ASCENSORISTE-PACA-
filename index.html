<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Admin - Documents Ascenseur</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      padding: 30px;
      max-width: 800px;
      margin: auto;
    }
    h1 {
      color: #333;
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
    }
    select {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border-radius: 4px;
      border: 1px solid #ccc;
      background-color: #fff;
    }
    #resultat {
      margin-top: 30px;
      background-color: #fff;
      padding: 20px;
      border-radius: 6px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }
    #resultat p {
      margin: 10px 0;
    }
    a {
      color: #0077cc;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <h1>üìÇ Fichiers techniques ascenseur</h1>

  <label for="marque">üîß Marque :</label>
  <select id="marque"></select>

  <label for="modele">üìò Mod√®le :</label>
  <select id="modele"></select>

  <label for="type_doc">üìÑ Type de document :</label>
  <select id="type_doc">
    <option value="technique">Technique</option>
    <option value="schema">Sch√©ma</option>
  </select>

  <div id="resultat"></div>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

    const supabaseUrl = 'https://TON_URL_SUPABASE.supabase.co'
    const supabaseKey = 'TON_ANON_KEY'
    const supabase = createClient(supabaseUrl, supabaseKey)

    const marqueSelect = document.getElementById('marque')
    const modeleSelect = document.getElementById('modele')
    const typeDocSelect = document.getElementById('type_doc')
    const resultatDiv = document.getElementById('resultat')

    async function chargerMarques() {
      const { data, error } = await supabase
        .from('documents')
        .select('marque')
      if (error) {
        console.error('Erreur chargement marques', error)
        return
      }
      const marques = [...new Set(data.map(item => item.marque).filter(Boolean))]
      marqueSelect.innerHTML = marques.map(m => `<option value="${m}">${m}</option>`).join('')
      chargerModeles()
    }

    async function chargerModeles() {
      const marqueChoisie = marqueSelect.value
      const { data, error } = await supabase
        .from('documents')
        .select('modele')
        .eq('marque', marqueChoisie)
      if (error) {
        console.error('Erreur chargement mod√®les', error)
        return
      }
      const modeles = [...new Set(data.map(item => item.modele).filter(Boolean))]
      modeleSelect.innerHTML = modeles.map(m => `<option value="${m}">${m}</option>`).join('')
      afficherFichiers()
    }

    async function afficherFichiers() {
      const marque = marqueSelect.value
      const modele = modeleSelect.value
      const type_doc = typeDocSelect.value

      const { data, error } = await supabase
        .from('documents')
        .select('filename, path')
        .eq('marque', marque)
        .eq('modele', modele)
        .eq('type_doc', type_doc)

      if (error) {
        console.error('Erreur chargement fichiers', error)
        return
      }

      if (data.length === 0) {
        resultatDiv.innerHTML = '<p>Aucun fichier trouv√©.</p>'
        return
      }

      resultatDiv.innerHTML = `<h3>üìÅ Fichiers disponibles :</h3>` + data.map(doc => `
        <p><a href="https://TON_URL_SUPABASE.supabase.co/storage/v1/object/public/${doc.path}" target="_blank">${doc.filename}</a></p>
      `).join('')
    }

    marqueSelect.addEventListener('change', chargerModeles)
    modeleSelect.addEventListener('change', afficherFichiers)
    typeDocSelect.addEventListener('change', afficherFichiers)

    chargerMarques()
  </script>
</body>
</html>
