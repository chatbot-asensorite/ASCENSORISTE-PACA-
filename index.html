<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagnostic Structure Table</title>
</head>
<body>
    <h1>üîç Diagnostic de la table "documents"</h1>
    <div id="diagnosticResult"></div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const SUPABASE_URL = 'https://prrzsosrbrskmeozmmmu.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_2nwtPyBWSeUNNtx06wROTw_Txpyk2W3';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        async function diagnoseTable() {
            try {
                // Test 1: R√©cup√©rer un document existant pour voir sa structure
                const { data: documents, error } = await supabase
                    .from('documents')
                    .select('*')
                    .limit(1);

                if (error) throw error;

                const resultDiv = document.getElementById('diagnosticResult');
                
                if (documents.length > 0) {
                    const firstDoc = documents[0];
                    resultDiv.innerHTML = `
                        <h2>‚úÖ Structure trouv√©e :</h2>
                        <pre>${JSON.stringify(firstDoc, null, 2)}</pre>
                        <h3>Noms de colonnes r√©els :</h3>
                        <ul>
                            ${Object.keys(firstDoc).map(col => `<li><strong>${col}</strong>: ${firstDoc[col]}</li>`).join('')}
                        </ul>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <h2>Table vide - Test d'insertion simple</h2>
                        <button onclick="testInsert()">Tester l'insertion</button>
                    `;
                }
            } catch (error) {
                document.getElementById('diagnosticResult').innerHTML = `
                    <h2>‚ùå Erreur :</h2>
                    <p>${error.message}</p>
                    <button onclick="testSimpleInsert()">Tester avec insertion basique</button>
                `;
            }
        }

        async function testSimpleInsert() {
            try {
                // Test avec seulement les colonnes de base
                const { data, error } = await supabase
                    .from('documents')
                    .insert([
                        { 
                            nom_fichier: 'test_simple.pdf',
                            date_upload: new Date().toISOString()
                        }
                    ]);

                if (error) throw error;
                alert('‚úÖ Insertion simple r√©ussie!');
                diagnoseTable();
            } catch (error) {
                alert(`‚ùå Erreur insertion simple: ${error.message}`);
            }
        }

        diagnoseTable();
    </script>
</body>
</html>
