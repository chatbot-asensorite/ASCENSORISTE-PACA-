<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ascensoriste PACA - Connexion</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Supabase JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <script>
        // Configuration Supabase
        const SUPABASE_URL = 'https://prrzsosrbrskmeozmmmu.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBycnpzb3NyYnJza21lb3ptbW11Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjEzMTkwMDMsImV4cCI6MjA3Njg5NTAwM30.JuqL6tJC5LRXX3OHXrznm_v9bca-aOJ_vnk_wPsP9Mc';
        const BUCKET_NAME = 'documents-pdfs';
        
        // Configuration Groq - √Ä MODIFIER AVEC TA CL√â
        const GROQ_API_KEY = 'votre-cle-groq-ici';

        // Initialisation
        let supabase;
        let currentUser = null;
        let currentDocuments = [];
        let filteredDocuments = [];
        let currentPan = null;

        // =================================================================
        // FONCTIONS D'AUTHENTIFICATION
        // =================================================================

        async function initApp() {
            try {
                console.log('üîÑ Initialisation de Supabase...');
                supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                console.log('‚úÖ Supabase initialis√©');
                
                await checkCurrentUser();
            } catch (error) {
                console.error('‚ùå Erreur initialisation:', error);
                showError('Erreur de configuration: ' + error.message);
            }
        }

        function showError(message) {
            console.error('Erreur:', message);
            const loginStatus = document.getElementById('login-status');
            if (loginStatus) {
                loginStatus.textContent = `‚ùå ${message}`;
                loginStatus.className = 'text-red-500';
            }
        }

        async function checkCurrentUser() {
            try {
                const { data: { user }, error } = await supabase.auth.getUser();
                if (error) throw error;

                if (user) {
                    currentUser = user;
                    console.log('üë§ Utilisateur connect√©:', user.email);
                    
                    // V√©rifier le r√¥le
                    const { data: userData, error: roleError } = await supabase
                        .from('techniciens')
                        .select('role')
                        .eq('id', user.id)
                        .single();

                    if (roleError) {
                        console.warn('Aucun profil technicien trouv√©, utilisation par d√©faut');
                        showTechnicianInterface();
                    } else if (userData && userData.role === 'admin') {
                        showAdminInterface();
                    } else {
                        showTechnicianInterface();
                    }
                } else {
                    showLoginInterface();
                }
            } catch (error) {
                console.error('‚ùå Erreur v√©rification utilisateur:', error);
                showLoginInterface();
            }
        }

        async function login() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const statusElement = document.getElementById('login-status');

            if (!email || !password) {
                statusElement.textContent = "Veuillez remplir tous les champs";
                statusElement.className = 'text-red-500';
                return;
            }

            statusElement.textContent = "üîê Connexion...";
            statusElement.className = 'text-blue-500';

            try {
                const { data, error } = await supabase.auth.signInWithPassword({
                    email: email,
                    password: password
                });

                if (error) throw error;

                currentUser = data.user;
                statusElement.textContent = "‚úÖ Connexion r√©ussie!";
                statusElement.className = 'text-green-500';
                
                // Redirection automatique
                setTimeout(() => {
                    showTechnicianInterface();
                }, 1000);

            } catch (error) {
                console.error('‚ùå Erreur connexion:', error);
                let errorMessage = "Erreur de connexion";
                
                if (error.message.includes('Invalid login credentials')) {
                    errorMessage = "Email ou mot de passe incorrect.";
                } else if (error.message.includes('Email not confirmed')) {
                    errorMessage = "Email non confirm√©.";
                }
                
                statusElement.textContent = `‚ùå ${errorMessage}`;
                statusElement.className = 'text-red-500';
            }
        }

        async function logout() {
            try {
                await supabase.auth.signOut();
                currentUser = null;
                showLoginInterface();
            } catch (error) {
                console.error('‚ùå Erreur d√©connexion:', error);
            }
        }

        function showLoginInterface() {
            document.getElementById('login-section').classList.remove('hidden');
            document.getElementById('admin-section').classList.add('hidden');
            document.getElementById('technician-section').classList.add('hidden');
        }

        function showAdminInterface() {
            document.getElementById('login-section').classList.add('hidden');
            document.getElementById('admin-section').classList.remove('hidden');
            document.getElementById('technician-section').classList.add('hidden');
        }

        function showTechnicianInterface() {
            document.getElementById('login-section').classList.add('hidden');
            document.getElementById('admin-section').classList.add('hidden');
            document.getElementById('technician-section').classList.remove('hidden');
            
            // Mettre √† jour l'email affich√©
            const userEmailElement = document.getElementById('tech-current-user-email');
            if (userEmailElement && currentUser) {
                userEmailElement.textContent = currentUser.email;
            }
            
            loadTechnicianData();
        }

        // =================================================================
        // NAVIGATION ONGLETS TECHNICIEN
        // =================================================================

        function showTechTab(tabName) {
            // Cacher tous les onglets
            document.getElementById('tech-tab-assistant').classList.add('hidden');
            document.getElementById('tech-tab-library').classList.add('hidden');
            
            // R√©initialiser les boutons
            const assistantBtn = document.getElementById('tab-btn-assistant');
            const libraryBtn = document.getElementById('tab-btn-library');
            
            assistantBtn.classList.remove('text-blue-600', 'border-blue-500');
            assistantBtn.classList.add('text-gray-500', 'border-transparent');
            libraryBtn.classList.remove('text-blue-600', 'border-blue-500');
            libraryBtn.classList.add('text-gray-500', 'border-transparent');
            
            // Activer l'onglet s√©lectionn√©
            if (tabName === 'assistant') {
                document.getElementById('tech-tab-assistant').classList.remove('hidden');
                assistantBtn.classList.add('text-blue-600', 'border-blue-500');
                assistantBtn.classList.remove('text-gray-500', 'border-transparent');
            } else if (tabName === 'library') {
                document.getElementById('tech-tab-library').classList.remove('hidden');
                libraryBtn.classList.add('text-blue-600', 'border-blue-500');
                libraryBtn.classList.remove('text-gray-500', 'border-transparent');
            }
        }

        // =================================================================
        // INTERFACE TECHNICIEN
        // =================================================================

        async function loadTechnicianData() {
            console.log('üîÑ Chargement des donn√©es technicien...');
            await loadDocumentsForTechnician();
            initializeChatbot();
        }

        async function loadDocumentsForTechnician() {
            const statusText = document.getElementById('tech-documents-status');
            
            try {
                if (statusText) {
                    statusText.textContent = "üîÑ Chargement des documents...";
                }

                const { data: documents, error } = await supabase
                    .from('documents')
                    .select('id, marque, type_ascenseur, categorie, model, nom_fichier, fichier_url, created_at')
                    .order('created_at', { ascending: false });

                if (error) throw error;

                currentDocuments = documents || [];
                filteredDocuments = [...currentDocuments];

                console.log(`‚úÖ ${currentDocuments.length} documents charg√©s`);

                if (statusText) {
                    statusText.textContent = currentDocuments.length === 0 ? 
                        "üìù Aucun document disponible" : 
                        `üìö ${currentDocuments.length} document(s) disponibles`;
                }
                
                updateTechnicianFilterOptions();

            } catch (error) {
                console.error('‚ùå Erreur chargement documents:', error);
                if (statusText) {
                    statusText.textContent = "‚ùå Erreur de chargement";
                }
            }
        }

        function updateTechnicianFilterOptions() {
            try {
                const marques = [...new Set(currentDocuments.map(doc => doc.marque).filter(Boolean))].sort();
                const types = [...new Set(currentDocuments.map(doc => doc.type_ascenseur).filter(Boolean))].sort();
                const categories = [...new Set(currentDocuments.map(doc => doc.categorie).filter(Boolean))].sort();
                
                // Filtres Biblioth√®que
                populateSelect('tech-filter-marque', marques);
                populateSelect('tech-filter-type', types);
                populateSelect('tech-filter-categorie', categories);
                
                // Filtres Assistant
                populateSelect('tech-assistant-filter-marque', marques);
                populateSelect('tech-assistant-filter-type', types);
                populateSelect('tech-assistant-filter-categorie', categories);
                
            } catch (error) {
                console.error('‚ùå Erreur mise √† jour filtres:', error);
            }
        }

        function populateSelect(selectId, options) {
            const select = document.getElementById(selectId);
            if (!select) {
                console.warn(`Selecteur ${selectId} non trouv√©`);
                return;
            }
            
            select.innerHTML = '<option value="">-- S√©lection --</option>';
            options.forEach(option => {
                if (option && option.trim()) {
                    const optionElement = document.createElement('option');
                    optionElement.value = option;
                    optionElement.textContent = option;
                    select.appendChild(optionElement);
                }
            });
        }

        // =================================================================
        // FONCTIONS ASSISTANT IA
        // =================================================================

        function selectPanneType(type) {
            console.log(`üîß Type de panne s√©lectionn√©: ${type}`);
            addToChatbot(`Mode s√©lectionn√© : **${type}**`, true);
            addToChatbot(`Mode ${type} activ√©. Veuillez d√©crire la panne.`);
        }

        function applyAssistantFilters() {
            try {
                const marque = document.getElementById('tech-assistant-filter-marque').value;
                const type = document.getElementById('tech-assistant-filter-type').value;
                const categorie = document.getElementById('tech-assistant-filter-categorie').value;

                const relevantDocs = currentDocuments.filter(doc => 
                    (!marque || doc.marque === marque) &&
                    (!type || doc.type_ascenseur === type) &&
                    (!categorie || doc.categorie === categorie)
                );

                console.log(`üìä ${relevantDocs.length} documents pertinents`);
                addToChatbot(`Contexte mis √† jour : ${marque || 'Toutes marques'}, ${type || 'Tous types'}, ${categorie || 'Toutes cat√©gories'}`);

            } catch (error) {
                console.error('‚ùå Erreur application filtres:', error);
            }
        }

        function initializeChatbot() {
            const chatMessages = document.getElementById('chat-messages');
            if (chatMessages) {
                chatMessages.innerHTML = '';
                addToChatbot("A.I (demande la description de la panne)");
            }
        }

        function addToChatbot(message, isUser = false) {
            const chatMessages = document.getElementById('chat-messages');
            if (!chatMessages) {
                console.error('‚ùå Zone de chat non trouv√©e');
                return;
            }

            const messageDiv = document.createElement('div');
            
            if (isUser) {
                messageDiv.className = 'text-right p-2';
                messageDiv.innerHTML = `<span class="bg-blue-500 text-white px-4 py-2 rounded-lg inline-block max-w-[80%]">${message}</span>`;
            } else {
                messageDiv.className = 'text-left p-2';
                if (message.includes("A.I")) {
                    messageDiv.innerHTML = `<span class="font-semibold text-gray-700">${message}</span>`;
                } else {
                    messageDiv.innerHTML = `<span class="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg inline-block max-w-[80%] border border-gray-300">${message.replace(/\n/g, '<br>')}</span>`;
                }
            }
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function startPanneDiagnostic() {
            currentPan = {
                marque: document.getElementById('tech-assistant-filter-marque').value || 'Non sp√©cifi√©e',
                type_ascenseur: document.getElementById('tech-assistant-filter-type').value || 'Non sp√©cifi√©',
                categorie: document.getElementById('tech-assistant-filter-categorie').value || 'Non sp√©cifi√©e',
                description: '',
                symptomes: '',
                documents_utiles: [],
                solution: '',
                status: 'en_cours'
            };

            addToChatbot("üîß **Diagnostic en cours...**");
            addToChatbot("Veuillez d√©crire la panne dans le champ ci-dessous.");
        }

        async function sendChatMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            
            if (!message) return;
            
            addToChatbot(message, true);
            input.value = '';
            
            try {
                if (!currentPan) {
                    startPanneDiagnostic();
                }

                currentPan.description = message;
                currentPan.symptomes = message;

                addToChatbot("üîÑ **Analyse de la panne en cours...**");

                // Simulation de r√©ponse (en attendant Groq)
                setTimeout(() => {
                    const simulatedResponse = `
**Analyse de la panne :** ${message}

**Solution recommand√©e :**
1. V√©rifier l'alimentation √©lectrique
2. Contr√¥ler les capteurs de s√©curit√©  
3. Consulter la documentation technique
4. Tester les composants m√©caniques

**Mode d√©mo** - Pour utiliser l'IA Groq :
1. Obtenez une cl√© API sur https://console.groq.com
2. Remplacez 'votre-cle-groq-ici' dans le code
                    `;
                    
                    addToChatbot(simulatedResponse);
                    
                    // Proposer de sauvegarder
                    addToChatbot("üíæ **Souhaitez-vous sauvegarder cette solution ?**");
                    addToChatbot('<button onclick="saveCurrentPanne()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded mr-2 text-sm">‚úÖ Oui</button><button onclick="discardCurrentPanne()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded text-sm">‚ùå Non</button>');
                }, 2000);

            } catch (error) {
                console.error('‚ùå Erreur envoi message:', error);
                addToChatbot("‚ùå Erreur lors de l'analyse : " + error.message);
            }
        }

        async function saveCurrentPanne() {
            if (!currentPan) return;

            try {
                addToChatbot("üíæ **Sauvegarde en cours...**");
                
                // Simulation de sauvegarde
                setTimeout(() => {
                    addToChatbot("‚úÖ **Solution sauvegard√©e avec succ√®s !**");
                    currentPan = null;
                }, 1000);

            } catch (error) {
                console.error('‚ùå Erreur sauvegarde:', error);
                addToChatbot("‚ùå **Erreur lors de la sauvegarde**");
            }
        }

        function discardCurrentPanne() {
            addToChatbot("‚ùå **Diagnostic annul√©.**");
            currentPan = null;
        }

        function handleChatInputKeypress(event) {
            if (event.key === 'Enter') {
                sendChatMessage();
            }
        }

        // =================================================================
        // BIBLIOTH√àQUE DE DOCUMENTS
        // =================================================================

        function applyTechnicianFilters() {
            try {
                const marque = document.getElementById('tech-filter-marque').value;
                const type = document.getElementById('tech-filter-type').value;
                const categorie = document.getElementById('tech-filter-categorie').value;
                const search = document.getElementById('tech-search').value.toLowerCase();
                
                filteredDocuments = currentDocuments.filter(doc => {
                    const matchesMarque = !marque || doc.marque === marque;
                    const matchesType = !type || doc.type_ascenseur === type;
                    const matchesCategorie = !categorie || doc.categorie === categorie;
                    const matchesSearch = !search || 
                        doc.marque.toLowerCase().includes(search) ||
                        doc.type_ascenseur.toLowerCase().includes(search) ||
                        doc.categorie.toLowerCase().includes(search) ||
                        doc.model.toLowerCase().includes(search) ||
                        doc.nom_fichier.toLowerCase().includes(search);
                    
                    return matchesMarque && matchesType && matchesCategorie && matchesSearch;
                });

                displayFilteredDocuments();

            } catch (error) {
                console.error('‚ùå Erreur application filtres:', error);
            }
        }

        function displayFilteredDocuments() {
            const container = document.getElementById('tech-documents-container');
            const statusText = document.getElementById('tech-documents-status');
            
            if (!container) return;
            
            container.innerHTML = '';

            if (filteredDocuments.length === 0) {
                if (statusText) statusText.textContent = "üîç Aucun document ne correspond aux crit√®res";
                container.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <i class="fas fa-search text-4xl mb-2"></i>
                        <p>Aucun document trouv√©</p>
                    </div>
                `;
                return;
            }

            if (statusText) statusText.textContent = `üìä ${filteredDocuments.length} document(s) filtr√©(s)`;

            filteredDocuments.forEach(doc => {
                const docElement = document.createElement('div');
                docElement.className = 'bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition-shadow border';
                docElement.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <h3 class="font-semibold text-gray-800">${doc.marque} - ${doc.model}</h3>
                            <p class="text-sm text-gray-600">${doc.type_ascenseur} ‚Ä¢ ${doc.categorie}</p>
                        </div>
                        <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">${doc.nom_fichier}</span>
                    </div>
                    <div class="flex space-x-2 mt-3">
                        <button onclick="openDocument('${doc.fichier_url}')" 
                                class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 px-3 rounded text-sm font-medium transition">
                            <i class="fas fa-eye mr-1"></i>Voir
                        </button>
                        <button onclick="askAboutDocument('${doc.id}')" 
                                class="flex-1 bg-green-600 hover:bg-green-700 text-white py-2 px-3 rounded text-sm font-medium transition">
                            <i class="fas fa-robot mr-1"></i>Question
                        </button>
                    </div>
                `;
                container.appendChild(docElement);
            });
        }

        function openDocument(url) {
            window.open(url, '_blank');
            addToChatbot(`üìÑ Document ouvert dans un nouvel onglet`);
        }

        function askAboutDocument(docId) {
            const doc = currentDocuments.find(d => d.id == docId);
            if (doc) {
                addToChatbot(`üìö Document s√©lectionn√© : ${doc.marque} ${doc.model} (${doc.type_ascenseur})`);
                showTechTab('assistant');
            }
        }

        function clearTechnicianFilters() {
            document.getElementById('tech-filter-marque').value = '';
            document.getElementById('tech-filter-type').value = '';
            document.getElementById('tech-filter-categorie').value = '';
            document.getElementById('tech-search').value = '';
            filteredDocuments = [...currentDocuments];
            displayFilteredDocuments();
        }

        function togglePasswordVisibility(inputId, iconId) {
            const passwordInput = document.getElementById(inputId);
            const eyeIcon = document.getElementById(iconId);
            
            if (!passwordInput || !eyeIcon) return;
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                eyeIcon.classList.remove('fa-eye');
                eyeIcon.classList.add('fa-eye-slash');
            } else {
                passwordInput.type = 'password';
                eyeIcon.classList.remove('fa-eye-slash');
                eyeIcon.classList.add('fa-eye');
            }
        }

        // =================================================================
        // FONCTIONS GLOBALES
        // =================================================================

        window.showTechTab = showTechTab;
        window.login = login;
        window.logout = logout;
        window.selectPanneType = selectPanneType;
        window.applyAssistantFilters = applyAssistantFilters;
        window.sendChatMessage = sendChatMessage;
        window.saveCurrentPanne = saveCurrentPanne;
        window.discardCurrentPanne = discardCurrentPanne;
        window.openDocument = openDocument;
        window.askAboutDocument = askAboutDocument;
        window.applyTechnicianFilters = applyTechnicianFilters;
        window.clearTechnicianFilters = clearTechnicianFilters;
        window.togglePasswordVisibility = togglePasswordVisibility;

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ D√©marrage de l application...');
            initApp();
        });

    </script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .chat-messages {
            height: 400px;
            overflow-y: auto;
        }
        .document-card {
            transition: all 0.3s ease;
        }
        .document-card:hover {
            transform: translateY(-2px);
        }
        .panne-btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            color: white;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            cursor: pointer;
        }
        .panne-btn-depannage {
            background-color: #ef4444;
        }
        .panne-btn-depannage:hover {
            background-color: #dc2626;
        }
        .panne-btn-programmation {
            background-color: #3b82f6;
        }
        .panne-btn-programmation:hover {
            background-color: #2563eb;
        }
        .password-container {
            position: relative;
        }
        .password-toggle {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            color: #6b7280;
            padding: 4px;
        }
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">

    <!-- Section Connexion -->
    <div id="login-section" class="min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-lg p-8 w-full max-w-md">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">üîê Connexion Technicien</h2>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                    <input type="email" id="login-email" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:border-blue-500 focus:ring-1 focus:ring-blue-500" placeholder="technicien@ascenseur-paca.fr" value="technicien@test.com">
                </div>
                
                <div class="password-container">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Mot de passe</label>
                    <input type="password" id="login-password" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 pr-10" placeholder="Votre mot de passe" value="password123">
                    <button type="button" class="password-toggle" onclick="togglePasswordVisibility('login-password', 'login-password-eye')">
                        <i id="login-password-eye" class="fas fa-eye"></i>
                    </button>
                </div>
                
                <button type="button" onclick="login()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition duration-200">
                    Se connecter
                </button>
                
                <p id="login-status" class="text-center text-sm font-medium mt-4 text-gray-600">
                    Utilisez vos identifiants Supabase
                </p>
            </div>
        </div>
    </div>

    <!-- Section Administration (simplifi√©e) -->
    <div id="admin-section" class="hidden">
        <div class="max-w-7xl mx-auto p-4">
            <div class="bg-white rounded-xl shadow-lg p-6 text-center">
                <h1 class="text-2xl font-bold text-gray-800 mb-4">Espace Administration</h1>
                <p class="text-gray-600 mb-4">Interface simplifi√©e pour le test</p>
                <button onclick="logout()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg">
                    D√©connexion
                </button>
            </div>
        </div>
    </div>

    <!-- Section Technicien -->
    <div id="technician-section" class="hidden min-h-screen bg-gray-50">
        <div class="max-w-7xl mx-auto p-4">
            <!-- En-t√™te Technicien -->
            <header class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <div class="flex justify-between items-center">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-800 mb-2">
                            üõ†Ô∏è Espace Technicien
                        </h1>
                        <p class="text-gray-600">Documentation technique et assistance IA</p>
                    </div>
                    <div class="bg-blue-50 rounded-lg px-4 py-2 text-right">
                        <p class="font-semibold text-gray-800" id="tech-current-user-email">Chargement...</p>
                        <button onclick="logout()" class="text-red-600 hover:text-red-800 text-sm font-medium">
                            üö™ D√©connexion
                        </button>
                    </div>
                </div>
            </header>

            <!-- Navigation par onglets -->
            <div class="mb-6">
                <div class="border-b border-gray-200">
                    <nav class="-mb-px flex space-x-8">
                        <button id="tab-btn-assistant" onclick="showTechTab('assistant')" class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm text-blue-600 border-blue-500">
                            ü§ñ Assistant IA
                        </button>
                        <button id="tab-btn-library" onclick="showTechTab('library')" class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300">
                            üìö Biblioth√®que
                        </button>
                    </nav>
                </div>
            </div>

            <!-- Onglet Assistant IA -->
            <div id="tech-tab-assistant">
                <div class="bg-white rounded-xl shadow-lg p-6 w-full max-w-4xl mx-auto">
                    
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">ü§ñ Assistant IA Technique</h2>

                    <!-- Filtres -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 p-4 bg-gray-50 rounded-lg border">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Marque</label>
                            <select id="tech-assistant-filter-marque" onchange="applyAssistantFilters()" 
                                    class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:border-blue-500 focus:ring-1 focus:ring-blue-500">
                                <option value="">-- S√©lection --</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Type</label>
                            <select id="tech-assistant-filter-type" onchange="applyAssistantFilters()" 
                                    class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:border-blue-500 focus:ring-1 focus:ring-blue-500">
                                <option value="">-- S√©lection --</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Cat√©gorie</label>
                            <select id="tech-assistant-filter-categorie" onchange="applyAssistantFilters()" 
                                    class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:border-blue-500 focus:ring-1 focus:ring-blue-500">
                                <option value="">-- S√©lection --</option>
                            </select>
                        </div>
                    </div>

                    <!-- Boutons type de panne -->
                    <div class="flex items-center space-x-4 mb-6">
                        <span class="font-medium text-gray-700">Type de panne :</span>
                        <button onclick="selectPanneType('D√©pannage')" class="panne-btn panne-btn-depannage">
                            üîß D√©pannage
                        </button>
                        <button onclick="selectPanneType('Programmation')" class="panne-btn panne-btn-programmation">
                            üíª Programmation
                        </button>
                    </div>

                    <!-- Chat -->
                    <div class="border-t pt-6">
                        <div id="chat-messages" class="chat-messages mb-4 p-4 bg-gray-100 rounded-lg h-64">
                            <!-- Messages du chat -->
                        </div>
                        
                        <div class="flex space-x-2">
                            <input type="text" id="chat-input" 
                                   placeholder="D√©crire la panne..."
                                   onkeypress="handleChatInputKeypress(event)"
                                   class="flex-1 border border-gray-300 rounded-lg px-3 py-3 focus:border-blue-500 focus:ring-1 focus:ring-blue-500">
                            <button onclick="sendChatMessage()" 
                                    class="bg-blue-600 hover:bg-blue-700 text-white px-5 py-3 rounded-lg font-medium transition">
                                üì§ Envoyer
                            </button>
                        </div>
                    </div>

                </div>
            </div>

            <!-- Onglet Biblioth√®que -->
            <div id="tech-tab-library" class="hidden">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Filtres -->
                    <div class="lg:col-span-1 space-y-6">
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h2 class="text-xl font-bold text-gray-800 mb-4">üîç Recherche</h2>
                            
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Recherche</label>
                                    <input type="text" id="tech-search" oninput="applyTechnicianFilters()" 
                                           class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:border-blue-500 focus:ring-1 focus:ring-blue-500" 
                                           placeholder="Marque, mod√®le...">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Marque</label>
                                    <select id="tech-filter-marque" onchange="applyTechnicianFilters()" 
                                            class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:border-blue-500 focus:ring-1 focus:ring-blue-500">
                                        <option value="">Toutes</option>
                                    </select>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Type</label>
                                    <select id="tech-filter-type" onchange="applyTechnicianFilters()" 
                                            class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:border-blue-500 focus:ring-1 focus:ring-blue-500">
                                        <option value="">Tous</option>
                                    </select>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Cat√©gorie</label>
                                    <select id="tech-filter-categorie" onchange="applyTechnicianFilters()" 
                                            class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:border-blue-500 focus:ring-1 focus:ring-blue-500">
                                        <option value="">Toutes</option>
                                    </select>
                                </div>

                                <button onclick="clearTechnicianFilters()" 
                                        class="w-full bg-gray-500 hover:bg-gray-600 text-white py-2 px-3 rounded text-sm font-medium transition">
                                    üóëÔ∏è R√©initialiser
                                </button>
                            </div>
                        </div>

                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-3">üìä √âtat</h3>
                            <p id="tech-documents-status" class="text-gray-600 text-sm">
                                Chargement...
                            </p>
                        </div>
                    </div>

                    <!-- Documents -->
                    <div class="lg:col-span-2">
                        <div class="bg-white rounded-xl shadow-lg p-6 h-full">
                            <h2 class="text-xl font-bold text-gray-800 mb-4">üìö Documents</h2>
                            
                            <div id="tech-documents-container" class="space-y-4 max-h-[600px] overflow-y-auto">
                                <div class="text-center text-gray-500 py-8">
                                    <i class="fas fa-search text-4xl mb-2"></i>
                                    <p>Utilisez les filtres pour afficher les documents</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</body>
</html>
